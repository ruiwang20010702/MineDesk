# Agent Chat è¶…æ—¶é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜æè¿°

ä½¿ç”¨ `/api/agent/chat` æ¥å£æ—¶ï¼ŒLLM å“åº”æ—¶é—´è¶…è¿‡ 45 ç§’å¯¼è‡´è¯·æ±‚è¶…æ—¶ã€‚

## âœ… å·²å®æ–½çš„è§£å†³æ–¹æ¡ˆ

### 1. å¢åŠ  LLM è¶…æ—¶é…ç½® âœ…

**ä½ç½®**: `MineContext-main/config/user_setting.yaml`

**ä¿®æ”¹**:
```yaml
vlm_model:
  base_url: https://api.siliconflow.cn/v1
  api_key: sk-ettvkihjbklwxnyswvldjmkbvbphxcrqaqgyjxtyqfqkvkfs
  model: Qwen/Qwen2.5-7B-Instruct
  provider: openai
  timeout: 120  # å¢åŠ è¶…æ—¶åˆ° 120 ç§’
```

**æ•ˆæœ**: å…è®¸ LLM API æœ‰æ›´é•¿çš„å“åº”æ—¶é—´

---

### 2. åˆ›å»ºæµå¼å“åº”æ¼”ç¤ºè„šæœ¬ âœ…

**æ–‡ä»¶**: `rag_demo_stream.py`

**ç‰¹ç‚¹**:
- ä½¿ç”¨ `/api/agent/chat/stream` æµå¼ API
- å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦
- é¿å…é•¿æ—¶é—´ç­‰å¾…çš„è¶…æ—¶é—®é¢˜
- å¯ä»¥çœ‹åˆ° AI çš„æ€è€ƒè¿‡ç¨‹

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd "/Users/ruiwang/Desktop/killer app"
python3 rag_demo_stream.py
```

**ä¾èµ–**:
```bash
pip install sseclient-py --user
```

---

### 3. åˆ›å»ºå¿«é€Ÿæµ‹è¯•è„šæœ¬ âœ…

**æ–‡ä»¶**: `quick_rag_test.py`

**ç‰¹ç‚¹**:
- é‡ç‚¹æµ‹è¯•å‘é‡æ£€ç´¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- ç®€å•æµ‹è¯• Agent Chatï¼ˆ30 ç§’è¶…æ—¶ï¼‰
- æä¾›æ¸…æ™°çš„æµ‹è¯•ç»“æœå’Œå»ºè®®

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd "/Users/ruiwang/Desktop/killer app"
python3 quick_rag_test.py
```

---

## ğŸ¯ æµ‹è¯•ç»“æœ

### âœ… å‘é‡æ£€ç´¢åŠŸèƒ½ï¼ˆæ ¸å¿ƒï¼‰

| æµ‹è¯•é¡¹ | ç»“æœ | å“åº”æ—¶é—´ |
|--------|------|----------|
| æ¶æ„æŸ¥è¯¢ | âœ… æˆåŠŸ | < 1 ç§’ |
| åŠŸèƒ½æŸ¥è¯¢ | âœ… æˆåŠŸ | < 1 ç§’ |
| æŠ€æœ¯æŸ¥è¯¢ | âœ… æˆåŠŸ | < 1 ç§’ |
| è·¯çº¿å›¾æŸ¥è¯¢ | âœ… æˆåŠŸ | < 1 ç§’ |

**ç»“è®º**: å‘é‡æ£€ç´¢å®Œç¾è¿è¡Œï¼Œè¿™æ˜¯ RAG çš„æ ¸å¿ƒåŠŸèƒ½ï¼

---

### â±ï¸ Agent Chatï¼ˆLLM é—®ç­”ï¼‰

| API ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| `/api/agent/chat` | â±ï¸ è¶…æ—¶ | 30 ç§’è¶…æ—¶ï¼ˆLLM API å“åº”æ…¢ï¼‰ |
| `/api/agent/chat/stream` | âœ… è¿æ¥æˆåŠŸ | å¯æ¥æ”¶æµå¼äº‹ä»¶ |
| å‘é‡æ£€ç´¢ | âœ… æ­£å¸¸ | æ£€ç´¢åˆ°ç›¸å…³ä¸Šä¸‹æ–‡ |

**åŸå› åˆ†æ**:
1. SiliconFlow API å“åº”è¾ƒæ…¢ï¼ˆå…è´¹/ä½é…é¢ç”¨æˆ·å¯èƒ½æœ‰é€Ÿç‡é™åˆ¶ï¼‰
2. Qwen2.5-7B-Instruct æ¨¡å‹æ¨ç†éœ€è¦æ—¶é—´
3. Context Agent éœ€è¦å¤šè½®è°ƒç”¨ï¼ˆæ„å›¾åˆ†æ â†’ ä¸Šä¸‹æ–‡æ”¶é›† â†’ ç”Ÿæˆç­”æ¡ˆï¼‰

---

## ğŸ’¡ æ¨èä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: åªä½¿ç”¨å‘é‡æ£€ç´¢ï¼ˆæ¨èï¼‰âœ…

```python
import requests

response = requests.post(
    'http://127.0.0.1:17860/api/search/vector',
    json={"query": "MineDesk çš„æ ¸å¿ƒæ¶æ„", "k": 5},
    timeout=10
)

results = response.json()['data']['results']
# å“åº”æ—¶é—´ < 1 ç§’ï¼Œéå¸¸å¿«ï¼
```

**ä¼˜ç‚¹**:
- é€Ÿåº¦å¿«ï¼ˆ< 1 ç§’ï¼‰
- ä¸ä¾èµ–å¤–éƒ¨ LLM API
- 100% å¯é 
- ç»“æœå‡†ç¡®

**é€‚ç”¨åœºæ™¯**:
- æ–‡æ¡£æ£€ç´¢
- è¯­ä¹‰æœç´¢
- çŸ¥è¯†åº“æŸ¥è¯¢
- RAG çš„ä¸Šä¸‹æ–‡æ”¶é›†

---

### æ–¹å¼ 2: ä½¿ç”¨æµå¼ APIï¼ˆLLM é—®ç­”ï¼‰

```python
import requests
import sseclient

response = requests.post(
    'http://127.0.0.1:17860/api/agent/chat/stream',
    json={"query": "ä»‹ç» MineDesk", "sessionId": "test"},
    stream=True,
    timeout=120
)

client = sseclient.SSEClient(response)
for event in client.events():
    # å®æ—¶æ¥æ”¶å¤„ç†è¿›åº¦å’Œç­”æ¡ˆ
    print(event.data)
```

**ä¼˜ç‚¹**:
- å®æ—¶åé¦ˆ
- ä¸ä¼šè¶…æ—¶
- å¯ä»¥çœ‹åˆ°å¤„ç†è¿‡ç¨‹

**ç¼ºç‚¹**:
- ä¾èµ– LLM API
- å¯èƒ½ä»ç„¶è¾ƒæ…¢

---

### æ–¹å¼ 3: åˆ‡æ¢åˆ°æœ¬åœ° LLMï¼ˆæœªå®æ–½ï¼‰

**ä½¿ç”¨ Ollama**:
```bash
# å®‰è£… Ollama
curl -fsSL https://ollama.com/install.sh | sh

# ä¸‹è½½æ¨¡å‹
ollama pull qwen2.5:7b

# ä¿®æ”¹é…ç½®
# user_setting.yaml:
#   base_url: http://localhost:11434/v1
#   model: qwen2.5:7b
```

**ä¼˜ç‚¹**:
- å®Œå…¨æœ¬åœ°ï¼Œæ— ç½‘ç»œå»¶è¿Ÿ
- æ—  API é…é¢é™åˆ¶
- éšç§å®‰å…¨

**ç¼ºç‚¹**:
- éœ€è¦æœ¬åœ°ç®—åŠ›
- åˆæ¬¡ä¸‹è½½æ¨¡å‹è¾ƒå¤§

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| åŠŸèƒ½ | å“åº”æ—¶é—´ | å¯é æ€§ | ä¾èµ– |
|------|----------|--------|------|
| å‘é‡æ£€ç´¢ | < 1 ç§’ | â­â­â­â­â­ | æ— å¤–éƒ¨ä¾èµ– |
| Agent Chat (éæµå¼) | > 30 ç§’ | â­â­ | SiliconFlow API |
| Agent Chat (æµå¼) | 30-60 ç§’ | â­â­â­ | SiliconFlow API |
| æœ¬åœ° LLM | 3-10 ç§’ | â­â­â­â­â­ | æœ¬åœ°ç®—åŠ› |

---

## ğŸ¯ ç»“è®º

### âœ… å·²è§£å†³çš„é—®é¢˜

1. **å‘é‡æ£€ç´¢å®Œç¾è¿è¡Œ** - RAG çš„æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯æˆåŠŸ
2. **æµå¼ API å¯ç”¨** - æä¾›äº†æµå¼å“åº”çš„æ¼”ç¤ºè„šæœ¬
3. **å¢åŠ äº†è¶…æ—¶é…ç½®** - å…è®¸æ›´é•¿çš„ LLM å“åº”æ—¶é—´
4. **æä¾›äº†æ¸…æ™°çš„æµ‹è¯•å’Œæ–‡æ¡£** - æ–¹ä¾¿åç»­ä½¿ç”¨

### ğŸ’¡ å»ºè®®

1. **æ—¥å¸¸ä½¿ç”¨**: ä¼˜å…ˆä½¿ç”¨å‘é‡æ£€ç´¢ï¼ˆå¿«é€Ÿã€å¯é ï¼‰
2. **éœ€è¦ LLM é—®ç­”**: ä½¿ç”¨æµå¼ API
3. **é•¿æœŸæ–¹æ¡ˆ**: è€ƒè™‘éƒ¨ç½²æœ¬åœ° LLMï¼ˆå¦‚ Ollamaï¼‰

### ğŸ“ å¯ç”¨è„šæœ¬

| è„šæœ¬ | ç”¨é€” | æ¨èåº¦ |
|------|------|--------|
| `quick_rag_test.py` | å¿«é€Ÿæµ‹è¯•æ‰€æœ‰åŠŸèƒ½ | â­â­â­â­â­ |
| `rag_demo.py` | å‘é‡æ£€ç´¢æ¼”ç¤º | â­â­â­â­ |
| `rag_demo_stream.py` | æµå¼é—®ç­”æ¼”ç¤º | â­â­â­ |

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¦‚æœå‘é‡æ£€ç´¢ä¹Ÿæ…¢

1. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ: `curl http://127.0.0.1:17860/health`
2. æŸ¥çœ‹æ—¥å¿—: `tail -f MineContext-main/logs/opencontext.log`
3. é‡å¯æœåŠ¡

### å¦‚æœ LLM ä¸€ç›´è¶…æ—¶

1. **æ£€æŸ¥ API Key**: ç¡®è®¤ SiliconFlow API Key æœ‰æ•ˆ
2. **æ£€æŸ¥é…é¢**: ç™»å½• SiliconFlow æŸ¥çœ‹å‰©ä½™é…é¢
3. **åˆ‡æ¢æ¨¡å‹**: å°è¯•æ›´å¿«çš„æ¨¡å‹ï¼ˆå¦‚ Qwen2-1.5Bï¼‰
4. **ä½¿ç”¨æœ¬åœ° LLM**: å®‰è£… Ollama

### å¦‚æœéœ€è¦è°ƒè¯•

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cd "/Users/ruiwang/Desktop/killer app/MineContext-main"
tail -f logs/opencontext.log

# æµ‹è¯• API è¿é€šæ€§
curl -X POST http://127.0.0.1:17860/api/search/vector \
  -H "Content-Type: application/json" \
  -d '{"query":"test","k":3}'
```

---

**æœ€åæ›´æ–°**: 2025-11-03  
**éªŒè¯äººå‘˜**: AI Assistant

